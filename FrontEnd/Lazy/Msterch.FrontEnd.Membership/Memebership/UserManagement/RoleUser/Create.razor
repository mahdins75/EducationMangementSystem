@* @page "/Membership/User/create"

@inject IUserService userService
@inject IGetDropDownDataService getDropDownDataService
@inject NavigationManager NavigationManager
@inject SweetAlertService SweetAlert


<div class="card mb-3">
    <div class="card-header">
        ساخت کاربر جدید
    </div>
    <div class="card-body">
        <EditForm Model="newUser" OnValidSubmit="@(() => AddUser())">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="row">
                <div class="col-md-3">
                    <label>@GetDisplayName(nameof(UserViewModel.Name))</label>
                    <InputText class="form-control" @bind-Value="newUser.Name" />
                    <ValidationMessage For="@(() => newUser.Name)" />

                </div>
                <div class="col-md-3">
                    <label>@GetDisplayName(nameof(UserViewModel.LastName))</label>
                    <InputText class="form-control" @bind-Value="newUser.LastName" />
                    <ValidationMessage For="@(() => newUser.LastName)" />

                </div>
                <div class="col-md-3">
                    <label>@GetDisplayName(nameof(UserViewModel.UserName))</label>
                    <InputText class="form-control" @bind-Value="newUser.UserName" />
                    <ValidationMessage For="@(() => newUser.UserName)" />

                </div>
                <div class="col-md-3">
                    <label>@GetDisplayName(nameof(UserViewModel.PhoneNumber))</label>
                    <InputText class="form-control" @bind-Value="newUser.PhoneNumber" />
                    <ValidationMessage For="@(() => newUser.PhoneNumber)" />

                </div>
                <div class="col-md-3">
                    <label>@GetDisplayName(nameof(UserViewModel.Password))</label>
                    <InputText type="password" class="form-control" @bind-Value="newUser.Password" />
                    <ValidationMessage For="@(() => newUser.Password)" />

                </div>
                <div class="col-md-3">
                    <label>@GetDisplayName(nameof(UserViewModel.ConfirmPassword))</label>
                    <InputText type="password" class="form-control" @bind-Value="newUser.ConfirmPassword" />
                    <ValidationMessage For="@(() => newUser.ConfirmPassword)" />
                </div>
                <div class="col-md-3">
                    <label>@GetDisplayName(nameof(UserViewModel.Address))</label>
                    <InputTextArea class="form-control" @bind-Value="newUser.Address" />
                </div>

            </div>
            <!-- Save Button -->
            <div class="row mt-3">
                <div class="col-md-12">
                    <button type="button" class="btn btn-primary" @onclick="AddUser">ذخیره تغییرات</button>
                </div>
            </div>
        </EditForm>
    </div>
</div>


@code {


    RadzenDropDown<int> statusDropDown = new();

    RadzenDropDown<string> ownerDropDown = new();

    List<UserViewModel> Users = new();

    [Parameter]
    public UserViewModel newUser { get; set; }

    [Parameter]
    public List<SelectListItem> statusDropDownData { get; set; }

    [Parameter]
    public List<SelectListItemStringValue> ownerDropDownData { get; set; }

    [Parameter]
    public RadzenDataGrid<UserViewModel> grid { get; set; }

    private string modalDisplayClass = "";

    private string modalStyle = "none !important";

    int count;

    bool isLoading = false;


    protected override async Task OnInitializedAsync()
    {
        newUser = new();
        statusDropDownData = new();
        ownerDropDownData = new();
        StateHasChanged();
    }
    async Task AddUser()
    {
        var result = await userService.CreateUser(new UserViewModel
            {
                Name = newUser.Name,
                UserName = newUser.UserName,
                LastName = newUser.LastName,
                PhoneNumber = newUser.PhoneNumber,
                Password = newUser.Password,
                ConfirmPassword = newUser.ConfirmPassword,
                Address = newUser.Address,
                Status = newUser.Status,
                IsActive = newUser.IsActive
            });
        if (!result.IsSuccess)
        {
            if ((result.ErrorCode != null && result.ErrorCode == "Unauthorized") || (result.ErrorCode != null && result.ErrorCode == "Forbiden"))
            {
                NavigationManager.NavigateTo("");

            }
            else
            {
                await SweetAlert.ShowAlert("خطا !", result.Message, "error");

            }

        }
        else
        {
            newUser = new UserViewModel();
        }
        await grid.Reload();
    }
    string GetDisplayName(string propertyName)
    {
        var prop = typeof(UserViewModel).GetProperty(propertyName);
        if (prop != null)
        {
            var displayAttr = prop.GetCustomAttributes(typeof(DisplayAttribute), false).FirstOrDefault() as DisplayAttribute;
            if (displayAttr != null)
            {
                return displayAttr.Name;
            }
        }
        return propertyName; // Fallback to property name if Display is not set
    }





}
 *@